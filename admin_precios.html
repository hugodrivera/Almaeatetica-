<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Administrar Precios</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f9f9f9; }
    .container { max-width: 1000px; margin: 30px auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #f0f0f0; }
    input[type="text"], input[type="number"] { width: 100%; padding: 5px; }
    .acciones button { margin-right: 5px; }
    .footer { text-align: center; margin-top: 40px; font-size: 0.9em; color: #888; }
    .btn-principal { background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 6px; display: inline-block; margin-top: 20px; }
    .btn-principal:hover { background: #0056b3; }
    .centrado { text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Gesti√≥n de Precios de Tratamientos</h1>

    <button onclick="cargarTratamientos()">üîÑ Recargar lista</button>
    <a href="admin.html" class="btn-principal">Volver al Panel</a>

    <table id="tablaTratamientos">
      <thead>
        <tr>
          <th>Rubro</th>
          <th>Subrubro</th>
          <th>Nombre</th>
          <th>Detalle</th>
          <th>Duraci√≥n</th>
          <th>Precio</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="centrado">
      <h3>Agregar nuevo tratamiento</h3>
      <table>
        <tr>
          <td><input type="text" id="nuevoRubro" placeholder="Rubro" /></td>
          <td><input type="text" id="nuevoSubrubro" placeholder="Subrubro" /></td>
          <td><input type="text" id="nuevoNombre" placeholder="Nombre" /></td>
          <td><input type="text" id="nuevoDetalle" placeholder="Detalle" /></td>
          <td><input type="text" id="nuevaDuracion" placeholder="Duraci√≥n" /></td>
          <td><input type="number" id="nuevoPrecio" placeholder="Precio" /></td>
          <td><button onclick="agregarTratamiento()">Agregar</button></td>
        </tr>
      </table>
    </div>

    <div class="footer">Sistema dise√±ado por Hugo Rivera</div>
  </div>

  <script>
    // ‚ö†Ô∏è IMPORTANTE: Reemplaz√° esta URL con la de tu Web App publicada desde Apps Script
    const API_URL = 'https://script.google.com/macros/s/AKfycbwT_B5lJvGiA9V8ITqNAitUWD2mQjsf1UB95LcknwucRUxaTO6eBKXSTsatbdcg0Srd/exec';

    let tratamientos = [];

    async function cargarTratamientos() {
      const res = await fetch(API_URL + '?sheet=Hoja2');
      const data = await res.json();
      tratamientos = data.sort((a, b) => a.nombre.localeCompare(b.nombre));
      mostrarTabla();
    }

    function mostrarTabla() {
      const tbody = document.querySelector('#tablaTratamientos tbody');
      tbody.innerHTML = '';
      tratamientos.forEach((t, index) => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td><input type="text" value="${t.rubro}" onchange="editarCampo(${index}, 'rubro', this.value)" /></td>
          <td><input type="text" value="${t.subrubro}" onchange="editarCampo(${index}, 'subrubro', this.value)" /></td>
          <td><input type="text" value="${t.nombre}" onchange="editarCampo(${index}, 'nombre', this.value)" /></td>
          <td><input type="text" value="${t.detalle}" onchange="editarCampo(${index}, 'detalle', this.value)" /></td>
          <td><input type="text" value="${t.duracion}" onchange="editarCampo(${index}, 'duracion', this.value)" /></td>
          <td><input type="number" value="${t.precio}" onchange="editarCampo(${index}, 'precio', this.value)" /></td>
          <td class="acciones">
            <button onclick="guardarEdicion(${index})">üíæ</button>
            <button onclick="eliminarTratamiento(${index})">üóëÔ∏è</button>
          </td>
        `;
        tbody.appendChild(fila);
      });
    }

    function editarCampo(index, campo, valor) {
      tratamientos[index][campo] = valor;
    }

    async function guardarEdicion(index) {
      const tratamiento = tratamientos[index];
      tratamiento.indice = index + 2; // +2 porque empieza en fila 2 en la hoja
      await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ accion: 'editar', tratamiento }),
      });
      alert('Tratamiento actualizado');
      cargarTratamientos();
    }

    async function eliminarTratamiento(index) {
      if (!confirm('¬øEst√°s seguro de eliminar este tratamiento?')) return;
      await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ accion: 'eliminar', indice: index + 2 }),
      });
      alert('Tratamiento eliminado');
      cargarTratamientos();
    }

    async function agregarTratamiento() {
      const nuevo = {
        rubro: document.getElementById('nuevoRubro').value,
        subrubro: document.getElementById('nuevoSubrubro').value,
        nombre: document.getElementById('nuevoNombre').value,
        detalle: document.getElementById('nuevoDetalle').value,
        duracion: document.getElementById('nuevaDuracion').value,
        precio: document.getElementById('nuevoPrecio').value
      };

      await fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ accion: 'agregar', tratamiento: nuevo }),
      });
      alert('Tratamiento agregado');
      document.querySelectorAll('input').forEach(i => i.value = '');
      cargarTratamientos();
    }

    cargarTratamientos();
  </script>
</body>
</html>

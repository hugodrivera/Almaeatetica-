<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'es',
      events: [],
      eventClick: function(info) {
        alert('Turno:\n' +
              'Nombre: ' + info.event.title + '\n' +
              'Profesional: ' + info.event.extendedProps.profesional + '\n' +
              'Servicio: ' + info.event.extendedProps.servicio);
      }
    });

    calendar.render();

    fetch('https://opensheet.elk.sh/15H4TSdJGTZGJS3VEXQ18bhyJWqJ04Ll-h6Y9LPZt30g/Hoja1')
      .then(response => {
        if (!response.ok) {
          throw new Error('Error en la conexiÃ³n');
        }
        return response.json();
      })
      .then(data => {
        const eventos = data
          .filter(turno => turno.nombre && turno.fecha && turno.hora) // <-- validamos que haya datos
          .map(turno => ({
            title: turno.nombre,
            start: turno.fecha + 'T' + turno.hora,
            extendedProps: {
              profesional: turno.profesional || '',
              servicio: turno.servicio || '',
              telefono: turno.telefono || ''
            }
          }));

        calendar.addEventSource(eventos);
      })
      .catch(error => {
        console.error('Error cargando turnos:', error);
      });
  });
</script>

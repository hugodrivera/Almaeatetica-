<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      locale: 'es',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      events: [],
      eventClick: function(info) {
        alert('Turno:\n' +
              'Nombre: ' + (info.event.title || '') + '\n' +
              'Profesional: ' + (info.event.extendedProps.profesional || '') + '\n' +
              'Servicio: ' + (info.event.extendedProps.servicio || '') + '\n' +
              'Teléfono: ' + (info.event.extendedProps.telefono || ''));
      }
    });

    calendar.render();

    fetch('https://opensheet.elk.sh/15H4TSdJGTZGJS3VEXQ18bhyJWqJ04Ll-h6Y9LPZt30g/Hoja%201')
      .then(response => response.json())
      .then(data => {
        if (!Array.isArray(data)) throw new Error('Datos no válidos');

        const eventos = data
          .filter(turno => turno.nombre && turno.fecha && turno.hora)
          .map(turno => ({
            title: turno.nombre,
            start: `${turno.fecha}T${turno.hora}`,
            extendedProps: {
              profesional: turno.profesional || '',
              servicio: turno.servicio || '',
              telefono: turno.telefono || ''
            }
          }));

        calendar.addEventSource(eventos);
      })
      .catch(error => {
        console.error('Error cargando turnos:', error);
        alert("⚠️ Hubo un problema al cargar los turnos. Verificá la hoja de cálculo.");
      });
  });
</script>
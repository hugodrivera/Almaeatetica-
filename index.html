<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reserva tu Turno - Alma Est√©tica</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fbe9f0;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      text-align: center;
      padding: 20px;
    }

    form {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      max-width: 350px;
      margin: auto;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
    }

    img {
      width: 160px;
      margin-bottom: 15px;
    }

    h1 {
      color: #c2185b;
      font-size: 26px;
      margin: 10px 0;
    }

    h3 {
      color: #ad1457;
      font-weight: normal;
      font-size: 18px;
    }

    p {
      font-size: 14px;
      color: #555;
    }

    @media (max-width: 480px) {
      form {
        padding: 20px;
        max-width: 90%;
      }
      input, select, button {
        font-size: 15px;
        padding: 10px;
      }
      h1 {
        font-size: 22px;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <img src="logo.jpg" alt="Logo Alma Est√©tica">

  <h1>Alma Est√©tica</h1>
  <h3>Belleza y Bienestar a tu medida</h3>
  <p>Sarmiento 407, Concepci√≥n, Tucum√°n</p>

  <form id="reservaForm">
    <input type="text" id="nombre" placeholder="Tu nombre" required><br>
    <input type="text" id="telefono" placeholder="Tu n√∫mero (sin +54)" required><br>

    <select id="profesional" required>
      <option value="">Seleccion√° un profesional</option>
      <option value="Melanie">Melanie</option>
      <option value="F√°tima">F√°tima</option>
      <option value="Dr. Maria">Dr. Maria</option>
      <option value="Maria">Maria</option>
      <option value="Cris">Cris</option>
      <option value="Alis">Alis</option>
    </select><br>

    <select id="servicio" required>
      <option value="">Seleccion√° un servicio</option>
      <optgroup label="Faciales">
        <option value="Hifu">Hifu</option>
        <option value="Limpieza Facial">Limpieza Facial</option>
        <option value="BB Glow">BB Glow</option>
        <option value="Radiofrecuencia Facial">Radiofrecuencia Facial</option>
      </optgroup>
      <optgroup label="Corporales">
        <option value="Cavitaci√≥n">Cavitaci√≥n</option>
        <option value="Criolip√≥lisis">Criolip√≥lisis</option>
        <option value="Radiofrecuencia Corporal">Radiofrecuencia Corporal</option>
        <option value="Presoterapia">Presoterapia</option>
        <option value="Crioterapia">Crioterapia</option>
        <option value="Ultrasonido Corporal">Ultrasonido Corporal</option>
      </optgroup>
      <optgroup label="Depilaci√≥n L√°ser">
        <option value="L√°ser para eliminar tatuajes">L√°ser para eliminar tatuajes</option>
        <option value="Depilaci√≥n definitiva">Depilaci√≥n definitiva</option>
      </optgroup>
      <optgroup label="Manos y Pies">
        <option value="U√±as">U√±as</option>
        <option value="Manicur√≠a">Manicur√≠a</option>
        <option value="Pedicur√≠a">Pedicur√≠a</option>
        <option value="Belleza de manos y pies">Belleza de manos y pies</option>
      </optgroup>
      <optgroup label="Cejas y Pesta√±as">
        <option value="Pesta√±as">Pesta√±as</option>
        <option value="Lifting de pesta√±as">Lifting de pesta√±as</option>
        <option value="Laminado de cejas">Laminado de cejas</option>
      </optgroup>
      <optgroup label="Peluquer√≠a">
        <option value="Corte de pelo">Corte de pelo</option>
        <option value="Tinturas">Tinturas</option>
        <option value="Coloraciones">Coloraciones</option>
        <option value="Mechas">Mechas</option>
        <option value="Peinados">Peinados</option>
      </optgroup>
    </select><br>

    <input type="date" id="fecha" required><br>
    <input type="time" id="hora" required><br>

    <button type="submit" id="botonEnviar">Reservar Turno</button><br>
    <button type="button" id="buscarTurno">Modificar / Eliminar mi Turno</button>
  </form>
</div>

<script>
  let idTurno = null;
  const url = 'https://script.google.com/macros/s/AKfycbx14SIRVYRHE9TbuNDSd-bJXOfrVBz6F65rG7PHhBHPPXG7fN9LG4E4j3X6SmznDa08/exec';

  // Funci√≥n para renderizar modal moderno
  function mostrarModal(turnos) {
    const modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
    modal.style.display = 'flex';
    modal.style.alignItems = 'center';
    modal.style.justifyContent = 'center';
    modal.style.zIndex = '9999';

    const caja = document.createElement('div');
    caja.style.background = '#fff';
    caja.style.padding = '20px';
    caja.style.borderRadius = '12px';
    caja.style.maxWidth = '90%';
    caja.style.width = '350px';
    caja.style.textAlign = 'center';
    caja.style.boxShadow = '0 4px 10px rgba(0,0,0,0.2)';

    const titulo = document.createElement('h3');
    titulo.innerText = 'Seleccion√° tu turno';
    titulo.style.marginBottom = '15px';
    caja.appendChild(titulo);

    turnos.forEach((turno, index) => {
      const btn = document.createElement('button');
      btn.innerText = `${turno.fecha} - ${turno.hora} (${turno.servicio})`;
      btn.style.display = 'block';
      btn.style.margin = '8px auto';
      btn.style.padding = '10px';
      btn.style.width = '100%';
      btn.style.borderRadius = '8px';
      btn.style.border = '1px solid #ccc';
      btn.style.backgroundColor = '#fce4ec';
      btn.style.cursor = 'pointer';
      btn.onclick = () => seleccionarTurno(turno, modal);
      caja.appendChild(btn);
    });

    const cerrar = document.createElement('button');
    cerrar.innerText = 'Cancelar';
    cerrar.style.marginTop = '15px';
    cerrar.style.padding = '10px';
    cerrar.style.width = '100%';
    cerrar.style.borderRadius = '8px';
    cerrar.style.border = 'none';
    cerrar.style.backgroundColor = '#eee';
    cerrar.onclick = () => document.body.removeChild(modal);
    caja.appendChild(cerrar);

    modal.appendChild(caja);
    document.body.appendChild(modal);
  }

  function seleccionarTurno(turno, modal) {
    idTurno = turno.id;
    document.getElementById('nombre').value = turno.nombre;
    document.getElementById('telefono').value = turno.telefono;
    document.getElementById('profesional').value = turno.profesional;
    document.getElementById('servicio').value = turno.servicio;
    document.getElementById('fecha').value = turno.fecha;
    document.getElementById('hora').value = turno.hora;

    modal.innerHTML = ''; // limpiar
    const caja = document.createElement('div');
    caja.style.background = '#fff';
    caja.style.padding = '20px';
    caja.style.borderRadius = '12px';
    caja.style.maxWidth = '90%';
    caja.style.width = '300px';
    caja.style.textAlign = 'center';

    const texto = document.createElement('p');
    texto.innerText = '¬øQu√© quer√©s hacer con este turno?';
    texto.style.marginBottom = '20px';
    caja.appendChild(texto);

    const btnModificar = document.createElement('button');
    btnModificar.innerText = '‚úèÔ∏è Modificar';
    btnModificar.style.margin = '5px';
    btnModificar.style.padding = '10px 20px';
    btnModificar.style.borderRadius = '8px';
    btnModificar.style.border = 'none';
    btnModificar.style.backgroundColor = '#81d4fa';
    btnModificar.style.color = '#000';
    btnModificar.onclick = () => {
      document.body.removeChild(modal);
      alert('‚úÖ Ahora pod√©s modificar y guardar el turno.');
    };
    caja.appendChild(btnModificar);

    const btnEliminar = document.createElement('button');
    btnEliminar.innerText = 'üóëÔ∏è Eliminar';
    btnEliminar.style.margin = '5px';
    btnEliminar.style.padding = '10px 20px';
    btnEliminar.style.borderRadius = '8px';
    btnEliminar.style.border = 'none';
    btnEliminar.style.backgroundColor = '#ef9a9a';
    btnEliminar.style.color = '#000';
    btnEliminar.onclick = () => {
      if (confirm('¬øEst√°s seguro que quer√©s eliminar este turno?')) {
        fetch(url + '?_method=DELETE', {
          method: 'POST',
          body: JSON.stringify({ id: idTurno })
        })
        .then(response => {
          if (response.ok) {
            alert('üóëÔ∏è Turno eliminado correctamente.');
            document.getElementById('reservaForm').reset();
            document.body.removeChild(modal);
            idTurno = null;
          } else {
            alert('‚ùå Error al eliminar el turno.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('‚ùå Error al eliminar el turno.');
        });
      }
    };
    caja.appendChild(btnEliminar);

    modal.appendChild(caja);
  }

  document.getElementById('reservaForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const nombre = document.getElementById('nombre').value;
    const telefono = document.getElementById('telefono').value;
    const profesional = document.getElementById('profesional').value;
    const servicio = document.getElementById('servicio').value;
    const fecha = document.getElementById('fecha').value;
    const hora = document.getElementById('hora').value;

    const data = {
      nombre,
      telefono,
      profesional,
      servicio,
      fecha,
      hora
    };

    if (idTurno) {
      data.id = idTurno;
      fetch(url + '?_method=PUT', {
        method: 'POST',
        body: JSON.stringify(data)
      })
      .then(response => {
        if (response.ok) {
          alert("‚úÖ Turno modificado exitosamente!");
          document.getElementById('reservaForm').reset();
          idTurno = null;
        } else {
          alert("‚ùå Error modificando el turno.");
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert("‚ùå Error modificando el turno.");
      });
    } else {
      fetch(url, {
        method: 'POST',
        body: JSON.stringify(data)
      })
      .then(response => {
        if (response.ok) {
          alert("‚úÖ Reserva enviada exitosamente!");
          document.getElementById('reservaForm').reset();
        } else {
          alert("‚ùå Hubo un problema enviando la reserva.");
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert("‚ùå Hubo un problema enviando la reserva.");
      });
    }
  });

  document.getElementById('buscarTurno').addEventListener('click', function() {
    const telefono = prompt('Ingres√° tu n√∫mero de tel√©fono para buscar tus turnos:');
    if (!telefono) return;

    fetch('https://opensheet.elk.sh/15H4TSdJGTZGJS3VEXQ18bhyJWqJ04Ll-h6Y9LPZt30g/Hoja 1')
      .then(response => response.json())
      .then(data => {
        const turnos = data
          .map((t, i) => ({ ...t, id: i + 2 }))
          .filter(t => t.telefono === telefono);

        if (turnos.length === 0) {
          alert('‚ùå No se encontr√≥ ning√∫n turno con ese n√∫mero.');
        } else if (turnos.length === 1) {
          seleccionarTurno(turnos[0], document.createElement('div'));
          alert('‚úÖ Turno encontrado. Ahora pod√©s modificar o eliminar.');
        } else {
          mostrarModal(turnos);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('‚ùå Error buscando los turnos.');
      });
  });
</script>


</body>
</html>

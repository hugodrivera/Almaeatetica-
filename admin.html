<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de Turnos - Tabla - Alma Est√©tica</title>
  <style>
    body {
      background: linear-gradient(120deg, #fce4ec, #f8bbd0);
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #c2185b;
      margin-bottom: 20px;
    }
    table {
      width: 95%;
      margin: auto;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #f8bbd0;
      color: #880e4f;
      font-size: 16px;
    }
    td {
      font-size: 14px;
      color: #555;
    }
    button {
      padding: 5px 10px;
      margin: 2px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }
    .editar { background: #c2185b; color: white; }
    .eliminar { background: #b71c1c; color: white; }
    .contador {
      margin: 10px 0 20px 0;
      font-size: 18px;
      color: #333;
    }
    .popup {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .popup-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
      text-align: center;
      width: 300px;
    }
    .popup-card input {
      width: 90%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    .popup-card button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
    }
    .guardar { background: #c2185b; color: white; }
    .cerrar { background: #555; color: white; margin-left: 10px; }
  </style>
</head>
<body>

<h1>Turnos Registrados - Alma Est√©tica</h1>
<div class="contador" id="contadorTurnos">Cargando turnos...</div>

<table>
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Tel√©fono</th>
      <th>Profesional</th>
      <th>Servicio</th>
      <th>Fecha</th>
      <th>Hora</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody id="turnos"></tbody>
</table>

<script>
const url = 'https://script.google.com/macros/s/AKfycbx14SIRVYRHE9TbuNDSd-bJXOfrVBz6F65rG7PHhBHPPXG7fN9LG4E4j3X6SmznDa08/exec';

function cargarTurnos() {
  fetch('https://opensheet.elk.sh/15H4TSdJGTZGJS3VEXQ18bhyJWqJ04Ll-h6Y9LPZt30g/Hoja 1')
    .then(response => response.json())
    .then(data => {
      document.getElementById('turnos').innerHTML = '';
      document.getElementById('contadorTurnos').innerText = `Total de turnos: ${data.length}`;

      data.forEach((turno, index) => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td>${turno.nombre}</td>
          <td>${turno.telefono}</td>
          <td>${turno.profesional}</td>
          <td>${turno.servicio}</td>
          <td>${turno.fecha}</td>
          <td>${turno.hora}</td>
          <td>
            <button class="editar" onclick="editarTurno(${index + 2}, '${turno.nombre}', '${turno.telefono}', '${turno.profesional}', '${turno.servicio}', '${turno.fecha}', '${turno.hora}')">Editar</button>
            <button class="eliminar" onclick="eliminarTurno(${index + 2})">Eliminar</button>
          </td>
        `;
        document.getElementById('turnos').appendChild(fila);
      });
    });
}

function editarTurno(id, nombre, telefono, profesional, servicio, fecha, hora) {
  const popup = document.createElement('div');
  popup.className = 'popup';
  popup.innerHTML = `
    <div class="popup-card">
      <h3>Editar Turno</h3>
      <input id="nombre" value="${nombre}">
      <input id="telefono" value="${telefono}">
      <input id="profesional" value="${profesional}">
      <input id="servicio" value="${servicio}">
      <input id="fecha" type="date" value="${fecha}">
      <input id="hora" type="time" value="${hora}">
      <br>
      <button class="guardar" onclick="guardarCambios(${id})">Guardar</button>
      <button class="cerrar" onclick="cerrarPopup()">Cancelar</button>
    </div>
  `;
  document.body.appendChild(popup);
}

function guardarCambios(id) {
  const updatedData = {
    id,
    nombre: document.getElementById('nombre').value,
    telefono: document.getElementById('telefono').value,
    profesional: document.getElementById('profesional').value,
    servicio: document.getElementById('servicio').value,
    fecha: document.getElementById('fecha').value,
    hora: document.getElementById('hora').value
  };

  fetch(url + '?_method=PUT', {
    method: 'POST',
    body: JSON.stringify(updatedData)
  })
  .then(response => {
    if (response.ok) {
      alert('‚úÖ Turno modificado.');
      window.location.reload();
    } else {
      alert('‚ùå Error modificando.');
    }
  });
}

function eliminarTurno(id) {
  if (confirm('¬øEliminar este turno?')) {
    fetch(url + '?_method=DELETE', {
      method: 'POST',
      body: JSON.stringify({ id })
    })
    .then(response => {
      if (response.ok) {
        alert('üóëÔ∏è Turno eliminado.');
        window.location.reload();
      } else {
        alert('‚ùå Error eliminando.');
      }
    });
  }
}

function cerrarPopup() {
  document.querySelector('.popup').remove();
}

cargarTurnos();
</script>

</body>
</html>
